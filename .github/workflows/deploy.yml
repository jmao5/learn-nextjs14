name: Deploy to Fly

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Build and push Docker image
      uses: superfly/flyctl-actions@v1.3
      with:
        build-args: |
          NEXT_PUBLIC_API_BASE_URL=${{ secrets.BACKEND_URL }}
          NEXT_PUBLIC_FE_URL=${{ secrets.FRONT_URL }}
          NEXT_PUBLIC_KAKAO_OAUTH_URL=${{ secrets.OAUTH_URL }}

    - name: Deploy to Fly
      uses: superfly/flyctl-actions@v1.3
      with:
        command: deploy
